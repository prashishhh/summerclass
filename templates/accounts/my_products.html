{% extends 'master/base.html' %}
{% load static %}
{% block content %}
<section class="section-conten padding-y bg">
  <div class="container">
    <div class="row">
      <aside class="col-md-3">
        {% include 'accounts/includes/sidebar.html' %}
      </aside>

      <main class="col-md-9">
        <article class="card">
          <header class="card-header d-flex justify-content-between align-items-center">
            <strong>My Products</strong>
            <div class="small text-muted">
              Total: {{ stats.total }} ·
              Approved: {{ stats.approved }} ·
              Pending: {{ stats.pending }} ·
              Inactive: {{ stats.inactive }}
            </div>
          </header>

          <div class="card-body p-0">
            {% if products and products.object_list %}
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="thead-light">
                    <tr>
                      <th style="width:56px;"></th>
                      <th>Product</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Stock</th>
                      <th>Status</th>
                      <th>Approval</th>
                      <th style="width:140px;">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for p in products %}
                      <tr>
                        <td>
                          {% if p.images %}
                            <img src="{{ p.images.url }}" alt="{{ p.product_name }}" style="width:48px;height:48px;object-fit:cover;border-radius:6px;">
                          {% else %}
                            <img src="{% static 'images/default/default-product.png' %}" style="width:48px;height:48px;object-fit:cover;border-radius:6px;">
                          {% endif %}
                        </td>
                        <td>
                          <div class="font-weight-500">{{ p.product_name }}</div>
                          <div class="small text-muted">
                            {% if p.is_approved and p.status %}
                              <a href="{{ p.get_url }}" target="_blank">View public page</a>
                            {% else %}
                              <span class="text-muted">Not publicly visible</span>
                            {% endif %}
                          </div>
                        </td>
                        <td>{{ p.category }}</td>
                        <td>Rs. {{ p.price }}</td>
                        <td>{{ p.stock }}</td>
                        <td>
                            {% if p.status %}
                                <span class="badge badge-primary">Active</span>
                            {% else %}
                                <span class="badge badge-secondary">Inactive</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if p.is_approved %}
                                <span class="badge badge-success">Approved</span>
                            {% else %}
                                <span class="badge badge-warning">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                          <a href="{% url 'edit_product' p.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                          <a href="{% url 'delete_product' p.id %}" class="btn btn-sm btn-outline-danger"
                             onclick="return confirm('Delete this product?');">Delete</a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

              <div class="p-3">
                {% if products.has_other_pages %}
                  <nav>
                    <ul class="pagination mb-0">
                      {% if products.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}">Previous</a></li>
                      {% else %}
                        <li class="page-item disabled"><span class="page-link">Previous</span></li>
                      {% endif %}
                      {% for i in products.paginator.page_range %}
                        {% if products.number == i %}
                          <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                        {% else %}
                          <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                        {% endif %}
                      {% endfor %}
                      {% if products.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}">Next</a></li>
                      {% else %}
                        <li class="page-item disabled"><span class="page-link">Next</span></li>
                      {% endif %}
                    </ul>
                  </nav>
                {% endif %}
              </div>
            {% else %}
              <div class="p-4 text-center text-muted">
                <p class="mb-2">You haven't posted any products yet.</p>
                <a href="{% url 'add_product' %}" class="btn btn-primary">Post your first product</a>
              </div>
            {% endif %}
          </div>
        </article>
      </main>
    </div>
  </div>
</section>
{% endblock %}
